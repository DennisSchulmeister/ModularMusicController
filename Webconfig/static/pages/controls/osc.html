<div x-data = "new ConfigTable({
    config:    `control/${$store.control.board}/${$store.control.slot}/osc`,
    canEdit:   true,
    canCreate: true,
    canDelete: true,
    initial:   [],

    extra: {
        servers: [{id: 't1', name: 'Test Server 1'}, {id: 't2', name: 'Test Server 2'}],
        selected_arguments: [],

        argumentTypeLabel: t => {
            switch (t) {
                case 'i': return 'Integer'; break;
                case 'f': return 'Float';   break;
                case 's': return 'String';  break;
                case 'b': return 'Bytes';   break;
                case 'S': return 'Symbol';  break;
                case 'T': return 'True';    break;
                case 'F': return 'False';   break;
                case 'N': return 'NIL';     break;
                default:  return t;
            }
        }
    },

    emptyLine: {
        send:      false,
        receive:   false,
        server:    '',
        address:   '',
        arguments: [],
    },

    sortFn: (lhs, rhs) => {
        if (lhs.server > rhs.server) return -1;
        if (lhs.server < rhs.server) return 1;

        if (lhs.address > rhs.address) return -1;
        if (lhs.address < rhs.address) return 1;

        return 0;
    },
})">
    <form @submit.prevent="">
        <div class="card-body">
            <!-- Table overview -->
            <template x-if="viewMode === 'table'">
                <div>
                    <p class="fw-light fst-italic" x-show="!data.length">
                        There are no OSC Messages, yet.
                    </p>

                    <table class="table table-striped" x-show="data.length">
                        <thead>
                            <tr scope="col">
                                <th scope="col">Nr.</th>
                                <th scope="col">Send</th>
                                <th scope="col">Receive</th>
                                <th scope="col">Server</th>
                                <th scope="col">Address</th>
                                <th scope="col">Arguments</th>
                            </tr>
                        </thead>

                        <tbody>
                            <template x-for="(entry, index) in data" :key="index">
                                <tr>
                                    <td>
                                        <div class="d-flex gap-2 align-items-center">
                                            <input
                                                class   = "form-check-input"
                                                type    = "checkbox"
                                                x-show  = "editMode"
                                                x-model = "selected"
                                                :value  = "index"
                                            >
                                            <a
                                                href   = "#"
                                                x-text = "index + 1"
                                                @click = "viewDetails(index); extra.selected_arguments = []"
                                            >
                                            </a>
                                        </div>
                                    </td>
                                    <td>
                                        <input class="form-check-input" type="checkbox" x-model="entry.read" :value="true" disabled>
                                    </td>
                                    <td>
                                        <input class="form-check-input" type="checkbox" x-model="entry.write" :value="true" disabled>
                                    </td>
                                    <td x-text="entry.server"></td>
                                    <td x-text="entry.address"></td>
                                    <td class="d-flex gap-1">
                                        <template x-for="arg in entry.arguments">
                                            <span x-text="extra.argumentTypeLabel(arg.type)"></span>
                                        </template>
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
            </template>

            <!-- Single entry -->
            <template x-if="viewMode !== 'table'">
                <div>
                    <div class="row mb-3">
                        <div class="col-md-3">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" x-model="currentLine.send" :disabled="!editMode">
                                <label class="form-check-label">Send Message</label>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" x-model="currentLine.receive" :disabled="!editMode">
                                <label class="form-check-label">Receive Message</label>
                            </div>
                        </div>
                    </div>

                    <div class="row mb-5">
                        <div class="col-md-6">
                            <label class="form-label">OSC Server</label>
                            <select class="form-select" x-model="currentLine.server" :disabled="!editMode">
                                <template x-for="_server in extra.servers">
                                    <option value="_server.id" x-text="_server.name"></option>
                                </template>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Address</label>
                            <input type="text" class="form-control" x-model="currentLine.address" :readonly="!editMode">
                        </div>
                    </div>

                    <h5>Arguments</h5>

                    <table class="table table-striped" x-show="currentLine.arguments.length">
                        <thead>
                            <tr>
                                <th scope="col">Nr.</th>
                                <th scope="col">Data Type</th>
                                <th scope="col" colspan="2">Value</td>
                            </tr>
                        </thead>
                        
                        <template x-for="(argument, index) in currentLine.arguments" :key="index">
                            <tr>
                                <td class="pt-2 pb-2">
                                    <input
                                        class   = "form-check-input"
                                        type    = "checkbox"
                                        x-show  = "editMode"
                                        x-model = "extra.selected_arguments"
                                        :value  = "index"
                                    >
                                    <span x-text="index + 1"></span>
                                </td>
                                <td class="pt-2 pb-2">
                                    <select class="form-select" x-model="argument.type" :disabled="!editMode">
                                        <option value="i">Integer</option>
                                        <option value="f">Float</option>
                                        <option value="s">String</option>
                                        <option value="b">Bytes</option>
                                        <option value="S">Symbol</option>
                                        <option value="T">True</option>
                                        <option value="F">False</option>
                                        <option value="N">NIL</option>
                                    </select>
                                </td>
                                <td class="pt-2 pb-2" style="width: 7em;">
                                    <select class="form-select" x-model="argument.format" :disabled="!editMode">
                                        <option value="text">Text</option>
                                        <option value="binary">Binary</option>
                                    </select>
                                </td>
                                <td class="pt-2 pb-2">
                                    <input
                                        type      = "text"
                                        class     = "form-control flex-grow-1"
                                        x-model   = "argument.value"
                                        :readonly = "!editMode && !['T', 'F', 'N'].includes(argument.type)"
                                    >
                                </td>
                            </tr>
                        </template>
                    </table>
    
                    <div>
                        TABLE EDIT ACTIONS
                    </div>
                </div>
            </template>
        </div>

        <div class="card-footer d-flex align-items-center gap-2">
            <div x-init="showPage('components/config-table-buttons.html', $el)" class="flex-fill"></div>

            <button
                type           = "button"
                @click         = "$store.control.goBack()"
                :class         = "`btn btn-light ${$store.nav.enabled ? '' : 'disabled'}`"
                :aria-disabled = "!$store.nav.enabled"
            >
                Back to Overview
            </button>
        </div>
    </form>
</div>