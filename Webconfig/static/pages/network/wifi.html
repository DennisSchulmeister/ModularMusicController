<div x-data = "new ConfigForm({
    config: 'wifi',
    canEdit: true,
    initial: {
        'mode':     '',
        'ssid':     '',
        'psk':      '',
        'username': '',
        'password': '',
    },
})">
    <form @submit.prevent="">
        <div class="row mb-3">
            <div class="col-md-6">
                <label class="form-label">WiFi Mode</label>
                <select class="form-select" x-model="data.mode" :disabled="!editMode">
                    <option value="disabled">Disabled</option>
                    <option value="access_point">Access Point</option>
                    <option value="station">Station/Client</option>
                </select>
            </div>

            <div class="col-md-6 align-self-end mt-3 mt-md-0">
                <button
                    type   = "button"
                    class  = "btn btn-dark"
                    x-show = "editMode && data.mode === 'station'"
                    @click = "
                        let popup = new Popup({
                            title: 'Scan Networks',
                            url:   'pages/network/wifi-scan.html',
                        });

                        popup.onClose(() => {
                            let ssid = popup.getResult();
                            
                            if (ssid) {
                                if (data.ssid !== ssid) data.psk = '';
                                data.ssid = ssid;
                            }
                        });

                        await popup.show();
                    "
                >
                    Scan Networks
                </button>

                <button
                    type   = "button"
                    class  = "btn btn-danger active"
                    x-show = "!editMode"
                    @click = "
                        if (confirm('Do you really want to reconnect the WiFi network?')) {
                            await api.postFunction('wifi-reconnect');
                            await showPage('pages/network/wifi-reconnect.html', '#page-content');
                        }
                    "
                >
                    Apply Now
                </button>
            </div>
        </div>

        <template x-if="data.mode != 'disabled'">
            <div class="row mb-3">
                <div class="col-md-6">
                    <label class="form-label">Network Name (SSID)</label>
                    <input x-model="data.ssid" type="text" class="form-control" :readonly="!editMode">
                </div>

                <div class="col-md-6">
                    <label class="form-label">Access Key (PSK)</label>
                    <input x-model="data.psk" type="password" class="form-control" :readonly="!editMode">
                </div>
            </div>
        </template>

        <div class="row mb-3" x-show="data.mode === 'station'">
            <div class="col-md-6">
                <label class="form-label">Username</label>
                <input x-model="data.username" type="text" class="form-control" :readonly="!editMode">
            </div>

            <div class="col-md-6">
                <label class="form-label">Password</label>
                <input x-model="data.password" type="password" class="form-control" :readonly="!editMode">
            </div>
        </div>

        <div class="row mb-3" x-show="data.mode === 'station'">
            <div class="col">
                <p class="fw-light fst-italic">
                    Note: Username and password are required in some enterprise networks for
                    personal authentication at the network. In a typical home environment or
                    guest network they are usually not used.
                </p>
            </div>
        </div>

        <div class="p-4"></div>
        <div x-init="showPage('components/config-form-buttons.html', $el)"></div>
    </form>
</div>